#!/usr/bin/env bash
# Function to check if Nginx is listening on port 80
check_nginx_port() {
    netstat -tuln | grep -q ':80'
    return $?
}

# Function to fix Nginx configuration to listen on port 80
fix_nginx_port() {
    # Replace any occurrence of 'listen 80' with 'listen 0.0.0.0:80' in the default Nginx configuration file
    sed -i 's/listen\s*80;/listen 0.0.0.0:80;/' /etc/nginx/sites-available/default

    # Restart Nginx to apply changes
    systemctl restart nginx
}

# Check if Nginx is listening on port 80
if check_nginx_port; then
    echo "Nginx is already listening on port 80."
else
    echo "Nginx is not listening on port 80. Fixing..."
    fix_nginx_port
    if check_nginx_port; then
        echo "Nginx is now listening on port 80."
    else
        echo "Failed to fix Nginx listening on port 80."
    fi
fi
